
# Oracle Cloud Keepalive Strategy

This document details the automated load generation strategy I have implemented to safeguard my Oracle Cloud "Always Free" Ampere instances from reclamation.

---

## 1. The Reclamation Rule

Oracle Cloud provides powerful ARM-based instances (up to 4 OCPUs and 24GB RAM) for free, but actively reclaims resources deemed "idle" to prioritize paying customers.

**The Trigger Conditions:**
Oracle monitors instances over a rolling 7-day period. An instance is flagged for reclamation if the **95th percentile of CPU utilization falls below 10%**.

**The Logic:**
My servers (`k3s-master` and `util-node-1`) are efficient, often idling at 1-2% CPU usage. This falls below the 10% threshold, putting them at risk of deletion. I have to generate artificial load to prove to Oracle that the servers are active.

---

## 2. Gateway Node (`utils-node-1`)

**Spec:** 1 OCPU  
**Challenge:** Generate sufficient load on a single core to raise the daily average above 10%.

### The Math:
Scheduled a `stress-ng` job to fill the CPU for 15 minutes every hour.

1.  **Usage During Stress:** 100% (1 Core fully saturated).
2.  **Duration Per Run:** 15 minutes.
3.  **Frequency:** 24 times per day (Once every hour).
4.  **Total Active Time:** $$15 \text{ min} \times 24 \text{ runs} = 360 \text{ minutes}$$
5.  **Total Daily Time:** $$24 \text{ hours} \times 60 \text{ min} = 1440 \text{ minutes}$$

**Daily Average Calculation:**

$$
\frac{360 \text{ active minutes}}{1440 \text{ total minutes}} \times 100\% \text{ Load} = 25\% \text{ Daily Average}
$$

**Conclusion:**

*   **Oracle Threshold:** >10%

*   **Our Load:** 25%

*   **Safety Margin:** **+15%** (Safe from reclamation, without wasting excessive energy).

### Configuration
```bash
# Command: Auto-detects 1 core and fills it for 15 minutes
/usr/bin/stress-ng --cpu 0 --timeout 900s
```
**Schedule (Cron):** `5 * * * *` (Minute 5 of every hour).

---

## 3. Production Node (`k3s-master`)

**Spec:** 3 OCPUs  
**Challenge:** A standard single-threaded process only fills 1 core. On a 3-core system, this results in only 33% system load, which is insufficient.

### The Math (Single Threads):
Running the same single-threaded test as above:

*   **System Load:** 33% (1 Core at 100%, 2 Cores at 0%).

*   **Daily Average:**
    $$
    33\% \text{ Load} \times 25\% \text{ Time} = 8.25\%
    $$
*   **Result:** **Unsafe** (Below the 10% threshold).

### The Math (Parallel Threads): 
By forcing 3 separate processes to run simultaneously, saturating all 3 cores.

1.  **Usage During Stress:** 100% (Core 0 + Core 1 + Core 2 saturated).
2.  **Duration Per Run:** 15 minutes.
3.  **Total Active Time:** 360 minutes.

**Daily Average Calculation:**

$$
\frac{360 \text{ active minutes}}{1440 \text{ total minutes}} \times 100\% \text{ System Load} = 25\% \text{ Daily Average}
$$

**Conclusion:**

*   **Oracle Threshold:** >10%

*   **Our Load:** 25%

*   **Safety Margin:** **+15%** (Safe).

### Configuration
Make a loop to spawn 3 concurrent cryptographic calculations.
```bash
# Command: Spawn 3 background processes and wait for completion
for i in 1 2 3; do cat /dev/urandom | md5sum & done; wait
```
**Kubernetes Limit:** `resources: limits: cpu: "3"` (Allows the pod to access all 3 cores).
